var states=[],target=new Phaser.Point,firststart=!0,cows=[],actors=[],ramps=0,music,music2,heartbeat,follow,gummi,gamestate="running",loaderEmpty,loaderFull,inputBlock=!1,zoomed=!1,cameraPos=new Phaser.Point(0,0),oldcamera,olddistance,distance,distancedelta,currentcameraposition=!1,currentcamerapositionX,currentcamerapositionY,followx,followy,rescalefactorx,rescalefactory,mapSizeMaxCurrent,mapSizeMax,mapSizeX,mapSizeY,constraintcount=0,cow_initial_health,hitSprite=!1,worldScale,cover,texture,cloverbar,
currentHealthbar=!1,lastHealthbar=!1,totalHits=0,totalHealthwasted=0,explosionSound=!1,content=" ;It's the year 2050...;global warming has caused a new ice age ...;thousands of cows all over the world have been trapped...;they wandered onto frozen ponds ...;and as no one had taught them how to skate ...;they ended up on their backs - helpless ...;a legion of 'free open source' penguins is there to help ...;but they alone can not succeed ... ;it is now up to you to save the cow population of the future ...;and to put all cows back into their paddocks.".split(";"),
introtext="",introindex=0,introline="",allStars=0,justLost=!1,randomnumber=2,ADtimer,NoFAD=!1,BootState={preload:function(){loader&&(game.load.image("loaderFull","assets/loaderfull.png"),game.load.image("loaderEmpty","assets/loaderempty.png"))},create:function(){game.device.desktop?(game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,game.scale.maxWidth=worldwidth,game.scale.maxHeight=worldheight,game.scale.pageAlignHorizontally=!0,game.scale.pageAlignVertically=!0):(game.scale.forceLandscape=!0,game.scale.fullScreenScaleMode=
Phaser.ScaleManager.EXACT_FIT,game.scale.scaleMode=Phaser.ScaleManager.EXACT_FIT);game.scale.setScreenSize(!0);game.state.start("preload")}},PreloadState={preload:function(){loader&&(loaderEmpty=game.add.sprite(0,0,"loaderEmpty"),loaderEmpty.x=game.world.centerX-loaderEmpty.width/2,loaderEmpty.y=game.world.centerY-loaderEmpty.height/2,loaderFull=game.add.sprite(0,0,"loaderFull"),loaderFull.x=game.world.centerX-loaderFull.width/2,loaderFull.y=game.world.centerY-loaderFull.height/2,game.load.setPreloadSprite(loaderFull));
game.load.script("gray","Gray.js");game.load.bitmapFont("desyrel","assets/fonts/font1.png","assets/fonts/font1.xml");game.load.audio("theme1","assets/sounds/cowrag.ogg",!1);game.load.audio("map","assets/sounds/cowtitlerag.ogg");game.load.audio("yeehaw","assets/sounds/yeehaw.ogg");game.load.audio("penguin1","assets/sounds/penguin1.ogg",!1);game.load.audio("penguin2","assets/sounds/penguin2.ogg",!1);game.load.audio("penguin3","assets/sounds/penguin3.ogg",!1);game.load.audio("moo1","assets/sounds/cow-moo1.ogg",
!1);game.load.audio("moo2","assets/sounds/cow-moo2.ogg",!1);game.load.audio("moo3","assets/sounds/cow-moo3.ogg",!1);game.load.audio("moo4","assets/sounds/cow-moo4.ogg",!1);game.load.audio("moo5","assets/sounds/cow-moo5.ogg",!1);game.load.audio("moo6","assets/sounds/cow-moo6.ogg",!1);game.load.audio("mooa1","assets/sounds/cow-whine1.ogg",!1);game.load.audio("mooa2","assets/sounds/cow-whine2.ogg",!1);game.load.audio("explosion","assets/sounds/explosion.ogg",!1);game.load.audio("leaves","assets/sounds/leaves.ogg",
!1);game.load.audio("splash","assets/sounds/splash.ogg");game.load.audio("splash1","assets/sounds/splash1.ogg",!1);game.load.audio("bumper","assets/sounds/bumper.ogg",!1);game.load.audio("click1","assets/sounds/click1.ogg",!1);game.load.audio("click2","assets/sounds/click2.ogg",!1);game.load.audio("click3","assets/sounds/click3.ogg",!1);game.load.audio("heartbeat","assets/sounds/heartbeat.ogg",!1);game.load.audio("cheer","assets/sounds/cheermoo.ogg",!1);game.load.tilemap("menu","./assets/levels/menu.json",
null,Phaser.Tilemap.TILED_JSON);for(i=0;i<levels;i++)game.load.tilemap("level"+i+"","./assets/levels/"+i+".json",null,Phaser.Tilemap.TILED_JSON),game.load.image("backgroundlevel"+i,"assets/levels/"+i+".png");game.load.physics("physicsData","./assets/polygons/rampleft.json");game.load.atlas("allsprites","assets/sprites/allsprites.png","assets/sprites/allsprites.jsona")},create:function(){music=game.add.audio("map",1,!0);music1=game.add.audio("theme1",1,!0);loader?(game.add.tween(loaderFull).to({alpha:0},
1E3,Phaser.Easing.Linear.None,!0),game.add.tween(loaderEmpty).to({alpha:0},1E3,Phaser.Easing.Linear.None,!0).onComplete.addOnce(function(){game.state.start(""+level+"")})):game.state.start(""+level+"")}},Menu={create:function(){!1===firststart&&game.add.existing(cover);setupMenuEvironment();for(var a=0;a<levels;a++){var b=localStorage.getItem(a);0<b&&(allStars+=parseInt(b))}game.add.bitmapText(47,worldheight-43,"desyrel","x "+allStars+"",24).fixedToCamera=!0;a=game.add.image(15,worldheight-40,"allsprites",
"star.png");a.scale.setTo(0.4,0.4);a.fixedToCamera=!0;levelbuttons=game.add.group();for(var b=1,d=0,a=page=0;a<levels;a++)d++,drawMenuButtons(a,b,d,page),1===d/4&&(b++,d=0),0===b%4&&b++,1===a%12&&page++;sky.height=worldheight*page;changeBounds(worldwidth,worldheight*page);game.physics.p2.updateBoundsCollisionGroup();for(a=1;a<page;a++)icon_down=game.add.button(worldwidth/2,a*worldheight-30,"allsprites",switchpagedown,this,"signs-forward.png","signs-forward.png","signs-forward.png"),icon_down.alpha=
0.6,icon_down.anchor.setTo(0.5,0.5),icon_down.angle=90,icon_up=game.add.button(worldwidth/2,a*worldheight+30,"allsprites",switchpageup,this,"signs-forward.png","signs-forward.png","signs-forward.png"),icon_up.alpha=0.6,icon_up.anchor.setTo(0.5,0.5),icon_up.angle=-90;setupObjects();setupPlants();setupEmitters();setupMouseAnchor();map.destroy();passiveGroup.add(levelbuttons);if(!0===ADS){if(!0===ADMENU){mainmenu=game.add.group();cornerbutton=game.add.button(worldwidth-64,0,"allsprites",function(){e.x<
worldwidth+40&&g.x<worldwidth+40&&-520>levelbuttons.x?(menu.forEach(function(a){game.add.tween(a).to({x:worldwidth+40},a.speed/2,Phaser.Easing.Quadratic.In,!0)}),game.add.tween(levelbuttons).to({x:0},400,Phaser.Easing.Quadratic.Out,!0)):0==levelbuttons.x&&(e.x=worldwidth+40,game.add.tween(e).to({x:game.camera.view.centerX},e.speed,Phaser.Easing.Quadratic.Out,!0),l.x=worldwidth+40,game.add.tween(l).to({x:game.camera.view.centerX},l.speed,Phaser.Easing.Quadratic.Out,!0),g.x=worldwidth+40,game.add.tween(g).to({x:game.camera.view.centerX-
70},g.speed,Phaser.Easing.Quadratic.Out,!0),levelbuttons.x=0,game.add.tween(levelbuttons).to({x:-worldwidth},250,Phaser.Easing.Quadratic.In,!0))},this,"menucorner-1.png","menucorner-2.png","menucorner-2.png");mainmenu.add(cornerbutton);mainmenu.fixedToCamera=!0;menu=game.add.group();var e=game.add.button(worldwidth+100,worldheight/2,"allsprites",function(){store.order("noads")},this,"button-inactive.png","button-active.png","button-active.png");e.anchor.setTo(0.5,0.5);var l=game.add.sprite(e.x,e.y,
"allsprites","signs-cart.png");l.alpha=0.8;l.anchor.setTo(0.5,0.5);e.speed=400;l.speed=400;var g=game.add.bitmapText(e.x,e.y+40,"desyrel","remove ads ",26);g.speed=500;menu.add(e);menu.add(l);menu.add(g);menu.fixedToCamera=!0}ADtimer=game.time.events.add(Phaser.Timer.SECOND*game.rnd.integerInRange(5,10),show_iAD);Preloader=game.time.events.add(500,function(){!0===firststart&&(music1.play("",0,1,!1),music1.stop(),firststart=!1)})}var h=game.add.button(30,30,"allsprites",function(){game.sound.mute=
!0;h.visible=!1;m.visible=!0},this,"signs-audio-on.png","signs-audio-on.png","signs-audio-on.png");h.anchor.setTo(0.5,0.5);h.fixedToCamera=!0;h.alpha=0.8;var m=game.add.button(30,30,"allsprites",function(){game.sound.mute=!1;m.visible=!1;h.visible=!0},this,"signs-audio-off.png","signs-audio-off.png","signs-audio-off.png");m.anchor.setTo(0.5,0.5);m.fixedToCamera=!0;m.alpha=0.8;m.visible=!1;!1==game.sound.mute?(h.visible=!0,m.visible=!1):(h.visible=!1,m.visible=!0);!0===firststart?game.time.events.add(0,
function(){game.add.tween(game.world).to({alpha:1},1E3,Phaser.Easing.Linear.None,!0)}):(cover.bringToTop(),game.time.events.add(0,fadeIn));game.time.events.loop(6*Phaser.Timer.SECOND,function(){game.sound.play("leaves",0.4);cloveremitter.x=cows[0].x;cloveremitter.y=cows[0].y;cloveremitter.explode(2E3,5)});fps&&(game.time.advancedTiming=!0,fpsText=game.add.text(60,40,"",{font:"16px Arial",fill:"#ffffff"}),fpsText.fixedToCamera=!0);192==allStars&&(a=game.add.bitmapText(worldwidth/2,40,"desyrel","192 stars ? Get a life !",
26),a.x-=a.width/2,stageGroup.add(a))},update:function(){fps&&0!==game.time.fps&&fpsText.setText(game.time.fps+" FPS");sky.tilePosition.x-=2;updateSpringAssets()},preRender:function(){mouseAnchor.body.x=game.camera.x+game.input.x;mouseAnchor.body.y=game.camera.y+game.input.y;gummi.angle=angleBetween(mouseAnchor,hitSprite)+90;gummi.height=distanceBetween(mouseAnchor,hitSprite);gummi.x=hitSprite.x;gummi.y=hitSprite.y}};
function switchpagedown(){!0!==inputBlock&&(game.sound.play("splash1",0.4),inputBlock=!0,game.time.events.add(500,function(){inputBlock=!1}),game.add.tween(game.camera).to({y:"+"+worldheight+""},500,Phaser.Easing.Quadratic.InOut,!0))}function switchpageup(){!0!==inputBlock&&(game.sound.play("splash1",0.4),inputBlock=!0,game.time.events.add(500,function(){inputBlock=!1}),game.add.tween(game.camera).to({y:"-"+worldheight+""},500,Phaser.Easing.Quadratic.InOut,!0))}
function drawMenuButtons(a,b,d,e){var l=localStorage.getItem(a-1);if(a>=levels-4){var g=game.add.button(worldwidth-worldwidth/5*(5-d),worldheight/4*b,"allsprites",function(){140>=allStars?(h.angle=0,shaketween=game.add.tween(h).to({angle:-10},100,Phaser.Easing.Linear.None,!0,0,5,!0)):(music.stop(),level=a,fadeOut(level))},this,"bush-tileset-06.png","bush-tileset-06.png","bush-tileset-06.png");g.anchor.setTo(0.5,0.5);g.scale.setTo(0.7,0.7);140>=allStars&&(g.alpha=0.3)}else g=game.add.button(worldwidth-
worldwidth/5*(5-d),worldheight/4*b,"allsprites",function(){0===a?(music.stop(),level=a,fadeOut("0")):0<l||!1===locked?(music.stop(),level=a,fadeOut(level)):(g.angle=0,shaketween=game.add.tween(h).to({angle:-10},100,Phaser.Easing.Linear.None,!0,0,5,!0))},this,"bush-tileset-06.png","bush-tileset-06.png","bush-tileset-06.png"),g.anchor.setTo(0.5,0.5),g.scale.setTo(0.7,0.7);b=0==a?game.add.bitmapText(g.x-4,g.y+5,"desyrel","#",40):a>=levels-4?game.add.bitmapText(g.x-4,g.y+5,"desyrel","+",40):game.add.bitmapText(g.x-
4,g.y,"desyrel",""+a+"",40);b.x-=b.width/2;b.y-=30;b.alpha=0.8;levelbuttons.add(g);levelbuttons.add(b);b=localStorage.getItem(a);if(a>=levels-4&&140>=allStars){var h=game.add.image(g.x+20,g.y+15,"allsprites","lock.png");h.anchor.setTo(0.5,0.5);h&&levelbuttons.add(h)}else if(a>=levels-4)for(k=0;k<b;k++)h=game.add.image(g.x-g.width/2+12*k,g.y+10,"allsprites","star.png"),h.scale.setTo(0.5,0.5),h&&levelbuttons.add(h);else if(null!=b&&0<=b)for(k=0;k<b;k++)h=game.add.image(g.x-g.width/2+12*k,g.y+10,"allsprites",
"star.png"),d=game.rnd.realInRange(0.48,0.56),h.scale.setTo(d,d),h&&levelbuttons.add(h);else 0<!l&&(0!==a&&!0===locked)&&(h=game.add.image(g.x+20,g.y+15,"allsprites","lock.png"),h.anchor.setTo(0.5,0.5),h&&levelbuttons.add(h))}
function changeBounds(a,b){game.world.setBounds(0,0,a,b,!0,!0,!0,!0);enemyGroundCG=game.physics.p2.createCollisionGroup();groundCG=game.physics.p2.createCollisionGroup();playerCG=game.physics.p2.createCollisionGroup();blocksCG=game.physics.p2.createCollisionGroup();iceBlocksCG=game.physics.p2.createCollisionGroup();anchorCG=game.physics.p2.createCollisionGroup();nocollideCG=game.physics.p2.createCollisionGroup()}
function setupMenuEvironment(){game.time.desiredFps=physicsFPS;music1.isPlaying&&music1.stop();heartbeat&&heartbeat.isPlaying&&heartbeat.stop();music.play("",0,1,!0);!0===firststart&&(game.world.alpha=0);justLost=!1;worldScale=1;zoomed=!1;cowsInLevel=cowCounter=olddistance=distance=0;hitSprite=!1;totalActors=totalAssetsDestroyed=totalAssets=totalHealthwasted=totalHits=cows.length=0;allStars=actors.length=0;NoFAD=!1;sky=game.add.tileSprite(0,0,worldwidth,worldheight,"allsprites","ice.png");game.physics.startSystem(Phaser.Physics.P2JS);
game.physics.p2.defaultRestitution=0.4;game.physics.p2.applyGravity=!1;map=game.add.tilemap("menu");bumperMaterial=game.physics.p2.createMaterial();playerMaterial=game.physics.p2.createMaterial();changeBounds(worldwidth,worldheight);setupDisplayGroups();game.camera.roundPx=!1;gray=game.add.filter("Gray")}
var Finish={create:function(){randomnumber=game.rnd.integerInRange(1,2);game.add.existing(cover);game.time.desiredFps=physicsFPS;var a=100-100/(totalAssets+cow_initial_health*cowsInLevel+cloversCollected)*(totalAssetsDestroyed+totalHits-cloversCollected+totalHealthwasted),a=Math.floor(a),b=Math.floor(a/22);4<b?b=4:0==b&&(b=1);0>a&&(a=0);ice=game.add.tileSprite(0,0,worldwidth,worldheight,"allsprites","ice.png");game.world.setBounds(0,0,worldwidth,worldheight);clearAllTies();playergroup.destroy(!0,
!0);if("lost"===gamestate)justLost=!0,a=game.add.bitmapText(game.world.centerX,game.world.centerY-100,"desyrel","Failed!",44),a.x=game.world.centerX-a.width/2,button=game.add.button(game.world.centerX,game.world.centerY,"allsprites",function(){fadeOut(""+level+"")},this,"button-inactive.png","button-active.png","button-active.png"),button.anchor.setTo(0.5,0.5),number=game.add.sprite(button.x,button.y,"allsprites","signs-retry.png"),number.anchor.setTo(0.5,0.5),b=game.rnd.integerInRange(0,6),b=0===
b?game.add.bitmapText(game.world.centerX,button.y+64,"desyrel","looks like you could use more cow-training ",28):1===b?game.add.bitmapText(game.world.centerX,button.y+64,"desyrel","you can do better ! ",28):2===b?game.add.bitmapText(game.world.centerX,button.y+64,"desyrel","oh..  so close ! ",28):3===b?game.add.bitmapText(game.world.centerX,button.y+64,"desyrel","cow for president !",28):4===b?game.add.bitmapText(game.world.centerX,button.y+64,"desyrel","my cat could do better than you !",28):4===
b?game.add.bitmapText(game.world.centerX,button.y+64,"desyrel","try harder !",28):game.add.bitmapText(game.world.centerX,button.y+64,"desyrel","don't give up ! ",28),b.x=game.world.centerX-b.width/2;else{justLost=!1;var d=localStorage.getItem(level);(null===d||d<b)&&localStorage.setItem(level,b);a=game.add.bitmapText(game.world.centerX,game.world.centerY-140,"desyrel","World "+level+" Cleared!",44);a.x=game.world.centerX-a.width/2;d=game.add.group();for(i=0;i<b;i++)var e=d.create(20*i,0,"allsprites",
"star.png");for(i=0;i<cloversCollected;i++){if(e)var l=140;d.create(20*i+l,0,"allsprites","clover_big.png")}d.x=game.world.centerX-d.width/2;d.y=a.y+64;b=game.add.bitmapText(game.world.centerX,d.y+64,"desyrel","cow pulls: "+totalHits,34);b.x=game.world.centerX-b.width/2;b=game.add.bitmapText(game.world.centerX,b.y+32,"desyrel","assets wasted: "+totalAssetsDestroyed,34);b.x=game.world.centerX-b.width/2;level=level===levels-5?"final":level===levels-1?"menu":level+1;"menu"==level?(button=game.add.button(game.world.centerX-
60,b.y+100,"allsprites",function(){level=levels-1;fadeOut(""+level+"")},this,"button-inactive.png","button-active.png","button-active.png"),button.anchor.setTo(0.5,0.5),number=game.add.sprite(button.x,button.y,"allsprites","signs-retry.png"),number.anchor.setTo(0.5,0.5),menubutton=game.add.button(game.world.centerX+60,b.y+100,"allsprites",function(){level="menu";fadeOut(""+level+"")},this,"button-inactive.png","button-active.png","button-active.png"),menubutton.anchor.setTo(0.5,0.5),number=game.add.sprite(menubutton.x,
menubutton.y,"allsprites","signs-menu.png")):"final"!==level?(button=game.add.button(game.world.centerX-100,b.y+100,"allsprites",function(){level-=1;fadeOut(""+level+"")},this,"button-inactive.png","button-active.png","button-active.png"),button.anchor.setTo(0.5,0.5),number=game.add.sprite(button.x,button.y,"allsprites","signs-retry.png"),number.anchor.setTo(0.5,0.5),button1=game.add.button(game.world.centerX+100,b.y+100,"allsprites",function(){fadeOut(""+level+"")},this,"button-inactive.png","button-active.png",
"button-active.png"),button1.anchor.setTo(0.5,0.5),number1=game.add.sprite(button1.x,button1.y,"allsprites","signs-forward.png"),number1.anchor.setTo(0.5,0.5),menubutton=game.add.button(game.world.centerX,b.y+100,"allsprites",function(){level="menu";fadeOut(""+level+"")},this,"button-inactive.png","button-active.png","button-active.png"),menubutton.anchor.setTo(0.5,0.5),number=game.add.sprite(menubutton.x,menubutton.y,"allsprites","signs-menu.png")):(button=game.add.button(game.world.centerX,b.y+
100,"allsprites",function(){fadeOut(""+level+"")},this,"button-inactive.png","button-active.png","button-active.png"),button.anchor.setTo(0.5,0.5),number=game.add.sprite(button.x,button.y,"allsprites","signs-forward.png"));number.anchor.setTo(0.5,0.5)}!0===ADS&&show_bAD();cover.bringToTop();game.time.events.add(0,fadeIn)},update:function(){ice.tilePosition.y+=2}},Final={create:function(){game.add.existing(cover);game.time.desiredFps=physicsFPS;ice=game.add.tileSprite(0,0,worldwidth,worldheight,"allsprites",
"ice.png");game.world.setBounds(0,0,worldwidth,worldheight);cloveremitter=game.add.emitter(0,0,40);cloveremitter.makeParticles("allsprites",["clover1.png","clover2.png","clover3.png"]);cloveremitter.setRotation(0,180);cloveremitter.setScale(0.2,0.9,2E3,Phaser.Easing.Quadratic.InOut,!1);cloveremitter.setAlpha(1,0,4E3,Phaser.Easing.Quadratic.Out);fireemitter=game.add.emitter(0,0,20);fireemitter.makeParticles("allsprites",["flash1.png","flash2.png"]);fireemitter.setScale(0.2,0.5,1E3,Phaser.Easing.Quadratic.InOut,
!1);fireemitter.setAlpha(1,0,1E3,Phaser.Easing.Quadratic.Out);fireemitter.setRotation(0,180);smokeemitter=game.add.emitter(0,0,15);smokeemitter.makeParticles("allsprites",["smoke1.png","smoke2.png","smoke-puff.png","lit-smoke.png"]);smokeemitter.setAlpha(1,0,6E3,Phaser.Easing.Quintic.Out);smokeemitter.setScale(0.5,1,0.5,1,6E3,Phaser.Easing.Quintic.Out);smokeemitter.setRotation(0,0);smokeemitter.gravity=-200;var a=game.add.bitmapText(game.world.centerX,game.world.centerY-160,"desyrel","Awesome! You did it!",
44);a.x=game.world.centerX-a.width/2;a=game.add.bitmapText(game.world.centerX,a.y+100,"desyrel","Cows all over the world are celebrating",30);a.x=game.world.centerX-a.width/2;a=game.add.bitmapText(game.world.centerX,a.y+40,"desyrel","you as their saviour.",30);a.x=game.world.centerX-a.width/2;a=game.add.bitmapText(game.world.centerX,a.y+40,"desyrel","Go get yourself a milkshake!",30);a.x=game.world.centerX-a.width/2;menubutton=game.add.button(game.world.centerX,worldheight-100,"allsprites",function(){level=
"menu";fadeOut(""+level+"")},this,"button-inactive.png","button-active.png","button-active.png");menubutton.anchor.setTo(0.5,0.5);number=game.add.sprite(menubutton.x,menubutton.y,"allsprites","signs-menu.png");number.anchor.setTo(0.5,0.5);game.time.events.loop(Phaser.Timer.SECOND*game.rnd.integerInRange(3,4),firework);game.time.events.loop(Phaser.Timer.SECOND*game.rnd.integerInRange(1,2),firework);game.time.events.loop(Phaser.Timer.SECOND*game.rnd.integerInRange(2,5),firework);cover.bringToTop();
game.time.events.add(0,fadeIn);game.sound.play("cheer",1)},update:function(){ice.tilePosition.y+=4}};function firework(){game.sound.play("leaves",0.4);game.sound.play("explosion",0.4);cloveremitter.x=game.rnd.integerInRange(0,worldwidth);cloveremitter.y=game.rnd.integerInRange(0,worldheight);cloveremitter.explode(2E3,15);fireemitter.x=cloveremitter.x;fireemitter.y=cloveremitter.y;fireemitter.explode(2E3,10);smokeemitter.x=fireemitter.x;smokeemitter.y=fireemitter.y;smokeemitter.explode(2E3,4)}
for(n=0;n<levels;n++)states[n]={create:function(){cover&&game.add.existing(cover);setupLevelEvironment();setupPhysics();setupLayers("level"+level,"allsprites","ice.png");setupObjects();setupPlants();setupEmitters();setupMouseAnchor();setupUI();mapSizeMaxCurrent=Phaser.Math.clamp(0,worldheight,mapSizeMax);map.destroy();map=null;fps&&(game.time.advancedTiming=!0,fpsText=game.add.text(60,40,"",{font:"16px Arial",fill:"#ffffff"}),fpsText.fixedToCamera=!0);if(0<ramps)game.physics.p2.world.on("preSolve",
onPresolve);cover&&cover.bringToTop();game.time.events.add(0,fadeIn);0==level&&(mapSizeMaxCurrent=mapSizeMax,hitSprite=actors[3],stageGroup.alpha=0,switchfocusbutton.visible=!1,icon_switchfocus.visible=!1,switchfocusbutton.alpha=0,icon_switchfocus.alpha=0)},update:function(){fps&&0!==game.time.fps&&fpsText.setText(game.time.fps+" FPS");updateSpringAssets();updateLevelstatus()},preRender:function(){game.input.activePointer.isDown&&!game.input.pointer2.isDown&&(rescalefactorx=mapSizeX/(mapSizeX*worldScale),
rescalefactory=mapSizeY/(mapSizeY*worldScale),mouseAnchor.body.x=(game.camera.x+game.input.x)*rescalefactorx,mouseAnchor.body.y=(game.camera.y+game.input.y)*rescalefactory,gummi.angle=angleBetween(mouseAnchor,hitSprite)+90,gummi.height=distanceBetween(mouseAnchor,hitSprite),gummi.x=hitSprite.x,gummi.y=hitSprite.y)}};
function setupLevelEvironment(){music.isPlaying&&music.stop();0!==level&&!music1.isPlaying&&music1.play("",0,0.6,!0);heartbeat&&heartbeat.isPlaying&&heartbeat.stop();gamestate="running";clickCounter=0;follow=hitSprite=!1;worldScale=1;zoomed=!1;ramps=0;lastHealthbar=currentHealthbar=currentcameraposition=!1;cowsInLevel=cowCounter=olddistance=distance=0;cows.length=0;totalActors=totalAssetsDestroyed=totalAssets=cloversCollected=totalHealthwasted=totalHits=actors.length=0;setupDisplayGroups();game.camera.roundPx=
!1;game.world.alpha=1;gray=game.add.filter("Gray");stagegray=game.add.filter("Gray");stagegray.gray=0.7}
function setupDisplayGroups(){stageGroup=game.add.group();passiveGroup=game.add.group();backgroundobjects=game.add.group();groundobjects=game.add.group();waterobjects=game.add.group();freezeobjects=game.add.group();mines=game.add.group();powerups=game.add.group();rampobjects=game.add.group();blockobjects=game.add.group();withoutbodyobjects=game.add.group();iceblocks=game.add.group();enemyobjects=game.add.group();woodblocks=game.add.group();finishlines=game.add.group();assets=game.add.group();playergroup=
game.add.group();plantobjects=game.add.group();uiobjects=game.add.group();passiveGroup.add(groundobjects);passiveGroup.add(waterobjects);passiveGroup.add(freezeobjects);passiveGroup.add(mines);passiveGroup.add(rampobjects);passiveGroup.add(blockobjects);passiveGroup.add(withoutbodyobjects);passiveGroup.add(finishlines);passiveGroup.add(iceblocks);passiveGroup.add(enemyobjects);passiveGroup.add(woodblocks);passiveGroup.add(powerups);passiveGroup.add(assets);passiveGroup.add(playergroup);passiveGroup.add(plantobjects);
stageGroup.add(backgroundobjects);stageGroup.add(passiveGroup)}
function setupUI(){mainmenu=game.add.group();cornerbutton=game.add.button(worldwidth-64,0,"allsprites",showIngameMenu,this,"menucorner-1.png","menucorner-2.png","menucorner-2.png");switchfocusbutton=game.add.button(worldwidth-60,worldheight-60,"allsprites",switchfocus,this,"button-inactive.png","button-active.png","button-active.png");switchfocusbutton.anchor.setTo(0.5,0.5);switchfocusbutton.onInputDown.add(function(){inputBlock=!0});switchfocusbutton.onInputUp.add(function(){inputBlock=!1});mainmenu.add(switchfocusbutton);
mainmenu.add(cornerbutton);mainmenu.fixedToCamera=!0;menu=game.add.group();var a=game.add.button(worldwidth+100,150,"allsprites",function(){fadeOut(game.state.current)},this,"button-inactive.png","button-active.png","button-active.png");a.anchor.setTo(0.5,0.5);var b=game.add.sprite(a.x,a.y,"allsprites","signs-retry.png");b.alpha=0.8;b.anchor.setTo(0.5,0.5);a.speed=200;b.speed=200;var d=game.add.button(worldwidth+100,250,"allsprites",function(){level="menu";fadeOut(level)},this,"button-inactive.png",
"button-active.png","button-active.png");d.anchor.setTo(0.5,0.5);var e=game.add.sprite(d.x,d.y,"allsprites","signs-menu.png");e.alpha=0.8;e.anchor.setTo(0.5,0.5);d.speed=300;e.speed=300;menu.add(a);menu.add(d);menu.add(b);menu.add(e);menu.fixedToCamera=!0;menu.visible=!1;gamemenu=game.add.group();icon_switchfocus=game.add.sprite(switchfocusbutton.x,switchfocusbutton.y,"allsprites","signs-recycle.png");icon_switchfocus.alpha=0.8;icon_switchfocus.anchor.setTo(0.5,0.5);gamemenu.add(icon_switchfocus);
gamemenu.fixedToCamera=!0;zoommenu=game.add.group();icon_zoom=game.add.sprite(switchfocusbutton.x,switchfocusbutton.y,"allsprites","signs-reset.png");icon_zoom.alpha=0.8;icon_zoom.anchor.setTo(0.5,0.5);zoommenu.add(icon_zoom);zoommenu.fixedToCamera=!0;zoommenu.alpha=0;zoommenu.visible=!1;anchormenu=game.add.group();icon_anchor=game.add.sprite(switchfocusbutton.x,switchfocusbutton.y,"allsprites","signs-cut.png");icon_anchor.alpha=0.8;icon_anchor.anchor.setTo(0.5,0.5);anchormenu.add(icon_anchor);anchormenu.fixedToCamera=
!0;anchormenu.alpha=0;anchormenu.visible=!1;0==level?leveltext=game.add.bitmapText(game.camera.view.centerX,game.camera.view.centerY,"desyrel","",50):(leveltext=game.add.bitmapText(game.camera.view.centerX,game.camera.view.centerY,"desyrel","-"+level+"-",50),leveltext.x=game.camera.view.centerX-leveltext.width/2,leveltext.y=game.camera.view.centerY-leveltext.height/2,leveltext.fixedToCamera=!0,uiobjects.add(leveltext));playerinfo=game.add.bitmapText(20,worldheight-40,"desyrel","no moves left",24);
playerinfo.fixedToCamera=!0;playerinfo.alpha=0;uiobjects.add(playerinfo);uiobjects.add(mainmenu);uiobjects.add(menu);uiobjects.add(zoommenu);uiobjects.add(anchormenu);uiobjects.add(gamemenu);cloverbar=game.add.tileSprite(10,10,0.1,30,"allsprites","cloversmall.png");cloverbar.fixedToCamera=!0;cloverbar.alpha=0.8;uiobjects.add(cloverbar)}
function setupPhysics(){game.physics.startSystem(Phaser.Physics.P2JS);game.physics.p2.defaultRestitution=0.2;game.world.enableBodySleeping=!0;game.physics.p2.applyGravity=!1;game.physics.p2.world.narrowphase.enableFriction=!1;game.physics.p2.setImpactEvents(!0);game.physics.p2.setImpactEvents(!1);game.physics.p2.emitImpactEvent=!1;game.canvas.oncontextmenu=function(a){a.preventDefault()};bumperMaterial=game.physics.p2.createMaterial();playerMaterial=game.physics.p2.createMaterial();woodboxMaterial=
game.physics.p2.createMaterial();game.physics.p2.createContactMaterial(bumperMaterial,playerMaterial,{restitution:1.6});game.physics.p2.createContactMaterial(bumperMaterial,woodboxMaterial,{restitution:35});game.time.desiredFps=physicsFPS}
function setupCollisionGroups(){enemyGroundCG=game.physics.p2.createCollisionGroup();enemyStaticCG=game.physics.p2.createCollisionGroup();groundCG=game.physics.p2.createCollisionGroup();playerCG=game.physics.p2.createCollisionGroup();blocksCG=game.physics.p2.createCollisionGroup();iceBlocksCG=game.physics.p2.createCollisionGroup();anchorCG=game.physics.p2.createCollisionGroup();nocollideCG=game.physics.p2.createCollisionGroup();game.physics.p2.updateBoundsCollisionGroup()}
function setupLayers(a,b,d){map=game.add.tilemap(a);mapSizeX=map.widthInPixels;mapSizeY=map.heightInPixels;map.widthInPixels<map.heightInPixels?(mapSizeMaxCurrent=map.widthInPixels*initialWorldScale,mapSizeMax=map.widthInPixels*initialWorldScale):(mapSizeMaxCurrent=map.heightInPixels*initialWorldScale,mapSizeMax=map.heightInPixels*initialWorldScale);background1=game.add.tileSprite(0,0,map.widthInPixels,map.heightInPixels,b,d);background2=game.add.image(0,0,"background"+a);backgroundobjects.add(background1);
backgroundobjects.add(background2);game.world.setBounds(0,0,map.widthInPixels,map.heightInPixels);setupCollisionGroups();enemyareas=game.physics.p2.convertCollisionObjects(map,"enemyareas");for(i=0;i<enemyareas.length;i++)enemyareas[i].setCollisionGroup(enemyGroundCG),enemyareas[i].collides([playerCG,iceBlocksCG]),enemyareas[i].enemy=!0;collisionareas=game.physics.p2.convertCollisionObjects(map,"collisionareas");for(i=0;i<collisionareas.length;i++)collisionareas[i].setCollisionGroup(groundCG),collisionareas[i].collides([playerCG,
enemyGroundCG,iceBlocksCG]),collisionareas[i].ground=!0}
function setupPlants(){map.createFromObjects("objects",1,"allsprites","bush-tileset-01.png",!0,!0,plantobjects);map.createFromObjects("objects",2,"allsprites","bush-tileset-02.png",!0,!0,plantobjects);map.createFromObjects("objects",3,"allsprites","bush-tileset-03.png",!0,!0,plantobjects);map.createFromObjects("objects",4,"allsprites","bush-tileset-04.png",!0,!0,plantobjects);map.createFromObjects("objects",5,"allsprites","bush-tileset-05.png",!0,!0,plantobjects);map.createFromObjects("objects",6,
"allsprites","bush-tileset-06.png",!0,!0,plantobjects);map.createFromObjects("objects",7,"allsprites","bush-tileset-07.png",!0,!0,plantobjects);map.createFromObjects("objects",11,"allsprites","grass-tileset-01.png",!0,!0,plantobjects);map.createFromObjects("objects",12,"allsprites","grass-tileset-02.png",!0,!0,plantobjects);map.createFromObjects("objects",13,"allsprites","grass-tileset-03.png",!0,!0,plantobjects);map.createFromObjects("objects",14,"allsprites","grass-tileset-04.png",!0,!0,plantobjects);
map.createFromObjects("objects",15,"allsprites","grass-tileset-05.png",!0,!0,plantobjects);map.createFromObjects("objects",16,"allsprites","grass-tileset-06.png",!0,!0,plantobjects);map.createFromObjects("objects",17,"allsprites","grass-tileset-07.png",!0,!0,plantobjects);map.createFromObjects("objects",18,"allsprites","grass-tileset-08.png",!0,!0,plantobjects);map.createFromObjects("objects",21,"allsprites","longplants-tileset-01.png",!0,!0,plantobjects);map.createFromObjects("objects",22,"allsprites",
"longplants-tileset-02.png",!0,!0,plantobjects);map.createFromObjects("objects",23,"allsprites","longplants-tileset-03.png",!0,!0,plantobjects);map.createFromObjects("objects",24,"allsprites","longplants-tileset-04.png",!0,!0,plantobjects);map.createFromObjects("objects",25,"allsprites","longplants-tileset-05.png",!0,!0,plantobjects);map.createFromObjects("objects",26,"allsprites","longplants-tileset-06.png",!0,!0,plantobjects);map.createFromObjects("objects",27,"allsprites","longplants-tileset-07.png",
!0,!0,plantobjects);map.createFromObjects("objects",28,"allsprites","longplants-tileset-08.png",!0,!0,plantobjects)}
function setupObjects(){map.createFromObjects("objects",31,"allsprites","ground-tileset-01.png",!0,!0,groundobjects);map.createFromObjects("objects",32,"allsprites","ground-tileset-02.png",!0,!0,groundobjects);map.createFromObjects("objects",33,"allsprites","ground-tileset-03.png",!0,!0,waterobjects);map.createFromObjects("objects",34,"allsprites","ground-tileset-04.png",!0,!0,waterobjects);map.createFromObjects("objects",35,"allsprites","waterhole-1.png",!0,!0,waterobjects);map.createFromObjects("objects",
36,"allsprites","waterhole-2.png",!0,!0,waterobjects);map.createFromObjects("objects",37,"allsprites","ground-tileset-07.png",!0,!0,rampobjects);map.createFromObjects("objects",38,"allsprites","ground-tileset-07.png",!0,!0,rampobjects);for(i=41;82>i;i++){var a="cowsonice-tileset-64-"+(i-40)+".png";41==i?map.createFromObjects("objects",i,"allsprites",a,!0,!0,woodblocks):42==i||65==i||69==i?map.createFromObjects("objects",i,"allsprites",a,!0,!0,iceblocks):48==i?map.createFromObjects("objects",i,"allsprites",
"help1.png",!0,!0,finishlines):49==i?map.createFromObjects("objects",i,"allsprites","windleft.png",!0,!0,finishlines):70==i?map.createFromObjects("objects",i,"allsprites","tuxbomb-spritesheet-1.png",!0,!0,assets):71==i?map.createFromObjects("objects",i,"allsprites","cow-spritesheet-07.png",!0,!0,playergroup):72==i?map.createFromObjects("objects",i,"allsprites","tuxminibomb-spritesheet-1.png",!0,!0,assets):73==i?map.createFromObjects("objects",i,"allsprites","tuxice-spritesheet-1.png",!0,!0,assets):
74==i?map.createFromObjects("objects",i,"allsprites","tuxanchor-spritesheet-1.png",!0,!0,assets):75==i?map.createFromObjects("objects",i,"allsprites","watermine.png",!0,!0,mines):76==i?map.createFromObjects("objects",i,"allsprites","clover3.png",!0,!0,powerups):77==i?map.createFromObjects("objects",i,"allsprites","bumper-spritesheet-1.png",!0,!0,mines):78==i?map.createFromObjects("objects",i,"allsprites","tuxtimebomb-spritesheet-1.png",!0,!0,assets):53==i||54==i?map.createFromObjects("objects",i,
"allsprites",a,!0,!0,withoutbodyobjects):55==i||56==i?map.createFromObjects("objects",i,"allsprites",a,!0,!0,enemyobjects):map.createFromObjects("objects",i,"allsprites",a,!0,!0,blockobjects)}for(i=82;121>i;i++)a="cowsonice-tileset-32-"+(i-81)+".png",82==i||83==i||84==i||85==i?map.createFromObjects("objects",i,"allsprites",a,!0,!0,finishlines):106==i||107==i||108==i?map.createFromObjects("objects",i,"allsprites",a,!0,!0,woodblocks):map.createFromObjects("objects",i,"allsprites",a,!0,!0,withoutbodyobjects);
finishlines.forEach(setupFinishline);waterobjects.forEach(setupWaterhole);mines.forEach(setupMines);rampobjects.forEach(setupRamps);blockobjects.forEach(setupBlocks);iceblocks.forEach(setupIceblocks);powerups.forEach(setupPowerups);woodblocks.forEach(setupWoodblocks);enemyobjects.forEach(setupEnemyobjects);assets.forEach(setupAssets);playergroup.forEach(setupSpringCow)}
function setupEmitters(){smokeemitter=game.add.emitter(0,0,10);smokeemitter.makeParticles("allsprites",["smoke1.png","smoke2.png","smoke-puff.png","lit-smoke.png"]);smokeemitter.setAlpha(1,0,6E3,Phaser.Easing.Quintic.Out);smokeemitter.setScale(0.5,1,0.5,1,6E3,Phaser.Easing.Quintic.Out);smokeemitter.setRotation(0,0);smokeemitter.gravity=0;glassemitter=game.add.emitter(0,0,12);glassemitter.makeParticles("allsprites","glass.png");glassemitter.setScale(0.2,0.5);glassemitter.gravity=0;woodemitter=game.add.emitter(0,
0,12);woodemitter.makeParticles("allsprites",["wood1.png","wood2.png","wood3.png"]);woodemitter.setScale(0.2,0.9);woodemitter.setAlpha(1,0,4E3,Phaser.Easing.Quintic.Out);woodemitter.gravity=0;fireemitter=game.add.emitter(0,0,8);fireemitter.makeParticles("allsprites",["flash1.png","flash2.png"]);fireemitter.setRotation(0,180);fireemitter.gravity=0;dropsemitter=game.add.emitter(0,0,20);dropsemitter.makeParticles("allsprites","drop1.png drop2.png drop3.png drop2.png drop5.png drop6.png drop7.png".split(" "));
dropsemitter.setAlpha(1,0,8E3,Phaser.Easing.Quadratic.Out);dropsemitter.setScale(0.5,1.3,0.5,1.3,1E3,Phaser.Easing.Quadratic.InOut,!0);dropsemitter.setRotation(0,90);dropsemitter.setSize(10,10);dropsemitter.gravity=0;cloveremitter=game.add.emitter(0,0,40);cloveremitter.makeParticles("allsprites",["clover1.png","clover2.png","clover3.png"]);cloveremitter.setRotation(0,180);cloveremitter.setScale(0.2,0.9,2E3,Phaser.Easing.Quadratic.InOut,!1);cloveremitter.setAlpha(1,0,4E3,Phaser.Easing.Quadratic.Out);
cloveremitter.gravity=0;plantobjects.add(fireemitter);plantobjects.add(glassemitter);plantobjects.add(smokeemitter);plantobjects.add(woodemitter);mines.add(dropsemitter);finishlines.add(cloveremitter)}
function setupFinishline(a){if(a)if("help1.png"==a.frameName&&("help1"==a.name?groundobjects.create(a.x,a.y,"allsprites","help1.png"):"help2"==a.name?groundobjects.create(a.x,a.y,"allsprites","help2.png"):"help3"==a.name?groundobjects.create(a.x,a.y,"allsprites","help3.png"):"help4"==a.name?groundobjects.create(a.x,a.y,"allsprites","help4.png"):"help5"==a.name?groundobjects.create(a.x,a.y,"allsprites","help5.png"):"help6"==a.name?groundobjects.create(a.x,a.y,"allsprites","help6.png"):"help7"==a.name&&
groundobjects.create(a.x,a.y,"allsprites","help7.png"),a.kill()),"windleft.png"==a.frameName){if("left"==a.name){var b=groundobjects.create(a.x,a.y,"allsprites","windleft.png");b.alpha=0.8}else"right"==a.name?(b=groundobjects.create(a.x,a.y,"allsprites","windright.png"),b.alpha=0.8):"up"==a.name?(b=groundobjects.create(a.x,a.y,"allsprites","windup.png"),b.alpha=0.8):"down"==a.name&&(b=groundobjects.create(a.x,a.y,"allsprites","winddown.png"),b.alpha=0.8);a.kill();game.physics.p2.applyGravity=!0;game.physics.p2.gravity.x=
a.gravityx;game.physics.p2.gravity.y=a.gravityy}else game.physics.p2.enable(a),a.body.x+=a.width/2,a.body.y+=a.height/2,a.type="finish",a.body.setCircle(24),a.body.data.gravityScale=0,a.body.static=!0,a.body.setCollisionGroup(playerCG),a.body.collides([playerCG]),a.body.data.shapes[0].sensor=!0,cow_initial_health=parseInt(a.name)}
function setupWaterhole(a,b,d,e){!0===e&&(a=waterobjects.create(b,d,"allsprites","waterhole-2.png"),waterobjects.add(a));a.iFrame=a.frameName;game.physics.p2.enable(a,!1);a.body.angle=0;a.alpha=0.8;a.name="waterhole";"waterhole-1.png"===a.iFrame?a.pivot.x=24:"waterhole-2.png"===a.iFrame&&(a.pivot.x=12,a.pivot.y=24);!0===e?a.freeze=game.add.sprite(a.x-a.width/2-12,a.y-a.height/2-12,"allsprites","freeze1.png"):("waterhole-1.png"===a.iFrame?(a.body.x+=a.width/2,a.body.y+=a.height/2):"waterhole-2.png"===
a.iFrame&&(a.body.x+=a.width/2,a.body.y+=a.height/2+24),a.freeze=game.add.sprite(a.x-15,a.y,"allsprites","freeze1.png"));a.freeze.animations.add("freeze","freeze1.png freeze2.png freeze3.png freeze4.png freeze5.png freeze6.png freeze7.png".split(" "),15,!1);freezeobjects.add(a.freeze);a.body.setCircle(30);a.body.data.gravityScale=0;a.body.static=!0;a.body.setCollisionGroup(playerCG);a.body.collides([playerCG])}
function setupRamps(a){ramps++;game.physics.p2.enable(a,!1);a.type="ramp";a.body.clearShapes();a.body.loadPolygon("physicsData","rampfromleft");"rampfromright"==a.name&&(a.body.angle=180);a.body.x+=a.width/2;a.body.y+=a.height/2;a.body.data.gravityScale=0;a.body.static=!0;a.body.setCollisionGroup(groundCG);a.body.collides([playerCG,anchorCG,iceBlocksCG])}
function setupIceblocks(a){game.physics.p2.enable(a,!1);a.name="iceblock";a.body.x+=a.width/2;a.body.y+=a.height/2;"cowsonice-tileset-64-25.png"===a.frameName||"cowsonice-tileset-64-29.png"===a.frameName?(a.body.static=!1,a.body.damping=0.992,a.body.angularDamping=0.999):(a.body.static=!0,a.body.damping=0.4);a.body.setMaterial(woodboxMaterial);a.body.setCollisionGroup(iceBlocksCG);a.body.collides([playerCG,iceBlocksCG,blocksCG,groundCG,enemyGroundCG,anchorCG])}
function setupEnemyobjects(a){game.physics.p2.enable(a,!1);a.name="enemyobject";a.body.x+=a.width/2;a.body.y+=a.height/2;a.body.angle=game.rnd.integerInRange(0,50);a.body.damping=0.95;a.body.angularDamping=0.9;a.body.enemy=!0;a.body.setRectangle(34,34);a.body.setMaterial(woodboxMaterial);a.body.setCollisionGroup(enemyGroundCG);a.body.collides([playerCG,iceBlocksCG,blocksCG,groundCG,enemyGroundCG,anchorCG])}
function setupBlocks(a){game.physics.p2.enable(a,!1);a.name="normalblock";a.body.x+=a.width/2;a.body.y+=a.height/2;a.body.data.gravityScale=0;a.body.static=!0;a.body.setCollisionGroup(blocksCG);a.body.collides([playerCG,iceBlocksCG,groundCG,enemyGroundCG,anchorCG])}
function setupWoodblocks(a){game.physics.p2.enable(a,!1);a.name="woodblock";a.type="cowsonice-tileset-32-25.png"===a.frameName||"cowsonice-tileset-32-26.png"===a.frameName||"cowsonice-tileset-32-27.png"===a.frameName?"small":"big";a.body.x+=a.width/2;a.body.y+=a.height/2;a.body.data.gravityScale=0;a.body.static=!0;a.body.setCollisionGroup(blocksCG);a.body.collides([playerCG,iceBlocksCG,anchorCG,enemyGroundCG])}
function setupPowerups(a){game.physics.p2.enable(a,!1);a.name="clover";a.body.setCircle(15);a.body.x+=a.width/2;a.body.y+=a.height/2;a.body.damping=0.995;a.body.angularDamping=0.999;a.body.mass=0.001;a.body.setMaterial(woodboxMaterial);a.body.setCollisionGroup(playerCG);a.body.collides([playerCG,iceBlocksCG,blocksCG,groundCG,enemyGroundCG,anchorCG])}
function setupMines(a){"bumper-spritesheet-1.png"==a.frameName?(game.physics.p2.enable(a,!1),a.animations.add("hit","bumper-spritesheet-1.png bumper-spritesheet-2.png bumper-spritesheet-3.png bumper-spritesheet-4.png bumper-spritesheet-3.png bumper-spritesheet-2.png bumper-spritesheet-1.png bumper-spritesheet-2.png bumper-spritesheet-3.png bumper-spritesheet-2.png bumper-spritesheet-1.png".split(" "),30,!1),a.name="bumper",a.body.setRectangle(48,48),a.body.x+=a.width/2-12,a.body.y+=a.height/2+12,
a.body.static=!0,a.body.setCollisionGroup(blocksCG),a.body.collides([playerCG,blocksCG,iceBlocksCG,enemyGroundCG]),a.body.setMaterial(bumperMaterial),a.body.onBeginContact.add(function(a){!0!=a.sprite.onAir&&(this.animations.play("hit"),game.sound.play("bumper"))},a)):(game.physics.p2.enable(a,!1),a.name="mine",a.body.setCircle(15),a.body.x+=a.width/2,a.body.y+=a.height/2,a.body.static=!0,a.body.setCollisionGroup(enemyGroundCG),a.body.collides([playerCG]))}
function setupMouseAnchor(){mouseAnchor=game.add.sprite(0,0);mouseAnchor.visible=!1;game.physics.p2.enable(mouseAnchor,!1);mouseAnchor.body.static=!0;mouseAnchor.body.setCircle(10);mouseAnchor.anchor.setTo(0.5,0);mouseAnchor.body.data.shapes[0].sensor=!0;mouseAnchor.body.setCollisionGroup(nocollideCG);gummi=game.add.image(0,0,"allsprites","gummi.png");gummi.width=5;gummi.height=4;gummi.visible=!1;gummi.anchor.setTo(0.5,0);finishlines.add(gummi)}
function setupSpringCow(a){a.health=cow_initial_health;a.name="springcow";a.invincibleTimer=0;a.animations.add("hit","cow-spritesheet-01.png cow-spritesheet-02.png cow-spritesheet-03.png cow-spritesheet-04.png cow-spritesheet-05.png cow-spritesheet-06.png cow-spritesheet-01.png cow-spritesheet-02.png cow-spritesheet-03.png cow-spritesheet-04.png cow-spritesheet-05.png cow-spritesheet-06.png cow-spritesheet-01.png".split(" "),10,!1);a.animations.add("die","cow-spritesheet-01.png cow-spritesheet-02.png cow-spritesheet-03.png cow-spritesheet-04.png cow-spritesheet-05.png cow-spritesheet-06.png".split(" "),
10,!0);a.animations.add("slide","cow-spritesheet-07.png cow-spritesheet-08.png cow-spritesheet-07.png cow-spritesheet-07.png cow-spritesheet-07.png cow-spritesheet-07.png cow-spritesheet-07.png cow-spritesheet-09.png cow-spritesheet-08.png cow-spritesheet-08.png cow-spritesheet-08.png".split(" "),2,!0);game.physics.p2.enable(a,!1);a.body.setCircle(45);a.body.x+=a.width/2-24;a.body.y+=a.height/2+24;a.body.mass=1;a.animations.play("slide");a.body.setCollisionGroup(playerCG);a.body.collides([groundCG,
enemyGroundCG,playerCG,blocksCG,iceBlocksCG,anchorCG]);a.body.setMaterial(playerMaterial);a.body.onBeginContact.add(springCowCollision,a.body);a.healthbar=game.add.tileSprite(10,game.camera.height-40,41*a.health,32,"allsprites","cowhead.png");a.healthbar.fixedToCamera=!0;a.healthbar.alpha=0.8;a.healthbar.visible=!1;uiobjects.add(a.healthbar);"menu"==level&&(a.body.velocity.x=50,a.body.velocity.y=50,a.body.angularVelocity=1,a.healthbar=!1);cows[cowsInLevel]=a;cowsInLevel+=1;actors[totalActors]=a;totalActors+=
1}
function setupAssets(a){a.type="tux";a.iFrame=a.frameName;a.scale.setTo(0.7,0.7);a.health=2;"tuxbomb-spritesheet-1.png"==a.iFrame?a.name="tuxbomb":"tuxminibomb-spritesheet-1.png"==a.iFrame?a.name="tuxminibomb":"tuxice-spritesheet-1.png"==a.iFrame?a.name="tuxice":"tuxanchor-spritesheet-1.png"==a.iFrame?a.name="tuxanchor":"tuxtimebomb-spritesheet-1.png"==a.iFrame&&(a.name="tuxtimebomb");a.animations.add("walk",[a.name+"-spritesheet-1.png",a.name+"-spritesheet-2.png",a.name+"-spritesheet-3.png",a.name+"-spritesheet-4.png",
a.name+"-spritesheet-5.png",a.name+"-spritesheet-6.png",a.name+"-spritesheet-7.png",a.name+"-spritesheet-6.png",a.name+"-spritesheet-5.png",a.name+"-spritesheet-4.png",a.name+"-spritesheet-3.png",a.name+"-spritesheet-2.png"],30,!0);game.physics.p2.enable(a,!1);a.body.setCircle(18);a.body.x+=a.width/2+6;a.body.y+=a.height/2+6;a.body.mass=1;a.body.setCollisionGroup(playerCG);a.body.collides([groundCG,enemyGroundCG,playerCG,blocksCG,iceBlocksCG]);a.body.setMaterial(playerMaterial);"tuxtimebomb"==a.name?
(a.trigger=!0,a.activetrigger=!1):a.trigger=!1;a.body.onBeginContact.add(helperTuxCollision,a.body);if("tuxanchor"==a.name){a.health=4;a.anchorgroup=game.add.group();stageGroup.add(a.anchorgroup);for(var b=a.body.x,d=a.body.y-90,e=1;6>=e;e++){var l=b,g=d+15*e;1===e?newElement=a.anchorgroup.create(l,g,"allsprites","chain-2.png"):6===e?newElement=a:0===e%2?newElement=a.anchorgroup.create(l,g,"allsprites","chain-3.png"):(newElement=a.anchorgroup.create(l,g,"allsprites","chain-4.png"),h.bringToTop());
6!==e&&(game.physics.p2.enable(newElement,!1),newElement.type="chain",newElement.body.data.gravityScale=0,newElement.body.setRectangle(12,15),newElement.body.mass=0.4,newElement.body.setCollisionGroup(anchorCG),newElement.body.collides([groundCG,enemyGroundCG,playerCG,blocksCG]));1===e&&(newElement.name="blockAnchor",newElement.type="chain",newElement.tux=a,newElement.body.setCollisionGroup(anchorCG),newElement.body.collides([groundCG,enemyGroundCG,playerCG,blocksCG,iceBlocksCG]),newElement.body.onBeginContact.add(fetchBlock,
newElement));h&&(thisconstraint=game.physics.p2.createRevoluteConstraint(newElement,[0,-7],h,[0,7],1E4),thisconstraint.setLimits(-1,1),thisconstraint.collideConnected=!1);var h=newElement}}a.healthbar=game.add.tileSprite(10,game.camera.height-35,54*a.health,48,"allsprites",a.name+"-spritesheet-1.png");a.healthbar.fixedToCamera=!0;a.healthbar.alpha=0.8;a.healthbar.scale.setTo(0.6,0.6);a.healthbar.visible=!1;uiobjects.add(a.healthbar);actors[totalActors]=a;totalActors+=1;totalAssets+=1}
function helperTuxCollision(a){var b=this;if(a&&a.trigger)b=a.body,gummi.visible=!1,explosionSound=game.sound.play("explosion"),a.trigger=!1,b.setCircle(70),b.setCollisionGroup(playerCG),b.collides([groundCG,enemyGroundCG,playerCG,blocksCG,iceBlocksCG]),fireemitter.x=b.x,fireemitter.y=b.y,fireemitter.explode(200,2),smokeemitter.x=b.x,smokeemitter.y=b.y,smokeemitter.explode(1400,4),b.sprite.visible=!1,game.time.events.add(100,function(){b.setCircle(1);b.static=!0}),game.time.events.add(2*Phaser.Timer.SECOND,
function(){hitSprite&&b==hitSprite.body&&(clearAllTies(),hitSprite=!1);b.sprite&&(b.sprite.kill(),b.sprite.destroy(),totalAssetsDestroyed+=1)});else if(a&&!(a&&!a.sprite||a&&"chain"===a.sprite.type||!0===b.sprite.onAir))if(("tuxtimebomb"==b.sprite.name&&!1==b.sprite.trigger||"tuxminibomb"==b.sprite.name||"tuxbomb"==b.sprite.name)&&("iceblock"==a.sprite.name||"woodblock"==a.sprite.name)){b.sprite==hitSprite&&(gummi.visible=!1);explosionSound.isPlaying||game.sound.play("explosion");b.static=!0;b.setCircle(90);
b.setCollisionGroup(playerCG);b.collides([groundCG,enemyGroundCG,playerCG,blocksCG,iceBlocksCG]);fireemitter.x=b.x;fireemitter.y=b.y;fireemitter.explode(200,2);smokeemitter.x=b.x;smokeemitter.y=b.y;smokeemitter.explode(1400,4);if("iceblock"==a.sprite.name)glassemitter.x=a.x,glassemitter.y=a.y,glassemitter.explode(400,6),!0===a.sprite.chained&&destroyAnchorConnection(a.sprite.blockAnchor.tux),a.sprite.destroy();else if("woodblock"==a.sprite.name&&("tuxbomb"==b.sprite.name||"tuxtimebomb"==b.sprite.name)){woodemitter.x=
a.x;woodemitter.y=a.y;woodemitter.explode(400,3);glassemitter.x=a.x;glassemitter.y=a.y;glassemitter.explode(400,3);if("big"==a.sprite.type)setupWaterhole(!1,a.x,a.y,!0);else{var d=game.add.image(a.x,a.y,"allsprites","waterholesmall.png");d.anchor.setTo(0.5,0.5);d.alpha=0.9;d.angle=d.x*d.y;waterobjects.add(d)}a.sprite.destroy()}b.sprite.visible=!1;game.time.events.add(100,function(){b.setCircle(9)});game.time.events.add(2*Phaser.Timer.SECOND,function(){hitSprite&&b==hitSprite.body&&(clearAllTies(),
hitSprite=!1);b.sprite&&(b.sprite.kill(),b.sprite.destroy(),totalAssetsDestroyed+=1)})}else"mine"==a.sprite.name?(b.sprite==hitSprite&&(gummi.visible=!1),playergroup.remove(b.sprite),plantobjects.add(b.sprite),b.sprite.onAir=!0,b.data.shapes[0].sensor=!0,totalAssetsDestroyed+=1,game.sound.play("explosion"),fireemitter.x=b.x,fireemitter.y=b.y,fireemitter.explode(200,4),smokeemitter.x=b.x,smokeemitter.y=b.y,smokeemitter.explode(1400,4),a.sprite.destroy(),setupWaterhole(!1,a.x,a.y,!0),b.sprite&&("tuxanchor"==
b.sprite.name&&(b.sprite.blockConstraint&&destroyAnchorConnection(b.sprite),game.add.tween(b.sprite.anchorgroup).to({alpha:0},1E3,Phaser.Easing.Quadratic.InOut,!0,0,0,!1).onComplete.add(function(){b.sprite.anchorgroup.destroy()})),a=game.add.tween(b.sprite.scale).to({x:20,y:20},2E3,Phaser.Easing.Sinusoidal.Out),d=game.add.tween(b.sprite).to({alpha:0},3E3,Phaser.Easing.Sinusoidal.Out),a.onComplete.add(function(){b.sprite&&(b.sprite.kill(),hitSprite&&b==hitSprite.body&&(clearAllTies(),hitSprite=!1),
b.sprite.destroy())}),a.start(),d.start())):"waterhole"===a.sprite.name&&drownInWater(a,b)}
function springCowCollision(a){var b=this;if(a&&!(!0===b.sprite.onAir||!a.sprite&&!0!==a.enemy||b.sprite.invincibleTimer-500>game.time.time))if(a.sprite&&"mine"==a.sprite.name){playergroup.remove(b.sprite);plantobjects.add(b.sprite);b.sprite.onAir=!0;hitSprite=b;gummi.visible=!1;game.sound.play("explosion");fireemitter.x=a.x;fireemitter.y=a.y;fireemitter.explode(200,2);smokeemitter.x=a.x;smokeemitter.y=a.y;smokeemitter.explode(1400,5);glassemitter.x=a.x;glassemitter.y=a.y;glassemitter.explode(400,
6);setupWaterhole(!1,a.x,a.y,!0);a.sprite.destroy();b.data.shapes[0].sensor=!0;var d=game.add.tween(b.sprite.scale).to({x:20,y:20},2E3,Phaser.Easing.Sinusoidal.Out),e=game.add.tween(b.sprite).to({alpha:0},3E3,Phaser.Easing.Sinusoidal.Out);d.onComplete.add(function(){b.sprite.health=0;gamestate="lost";b.sprite.animations.play("die");game.time.events.add(2*Phaser.Timer.SECOND,function(){fadeOut("finish")})});d.start();e.start()}else!0===a.enemy?(0<b.sprite.health&&(b.sprite.healthbar.width-=41),b.sprite.health-=
1,totalHealthwasted++,b.sprite.invincibleTimer=game.time.time+1E3,b.sprite.animations.play("hit").onComplete.add(function(){b.sprite.animations.play("slide")}),game.sound.play("mooa"+game.rnd.between(1,2)+"",0.2),0==b.sprite.health&&(b.sprite.filters=[gray],b.sprite.alpha=0.8,game.add.tween(playerinfo).to({alpha:1},300,Phaser.Easing.Linear.None).to({alpha:0},1500,Phaser.Easing.Linear.None).start()),-1==b.sprite.health&&(gamestate="lost",hitSprite=b,b.sprite.animations.play("die"),game.time.events.add(2*
Phaser.Timer.SECOND,function(){fadeOut("finish")}))):a.sprite&&"waterhole"===a.sprite.name?drownInWater(a,b):a&&a.sprite&&"finish"===a.sprite.type?(game.physics.p2.createRevoluteConstraint(b,[0,32],a,[0,0],1E4),game.sound.play("yeehaw",0.6),cowCounter+=1,b.sprite==hitSprite&&(gummi.visible=!1),a&&(b.sprite.finished=!0,game.time.events.add(2*Phaser.Timer.SECOND,function(){a&&a.sprite&&a.sprite.destroy();b.static=!0;b.sprite.healthbar.visible=!1;clearAllTies();hitSprite=!1})),cowCounter==cowsInLevel&&
game.time.events.add(2*Phaser.Timer.SECOND,function(){fadeOut("finish")})):a.sprite&&"clover"===a.sprite.name&&(game.sound.play("leaves",0.4),cloveremitter.x=a.x,cloveremitter.y=a.y,cloveremitter.explode(2E3,5),a.sprite.destroy(),cloversCollected+=1,cloverbar.width+=32,b.sprite.healthbar.width+=41,b.sprite.health+=1,1==b.sprite.health&&(hitSprite.filters="",hitSprite.alpha=1))}
function drownInWater(a,b){game.sound.play("splash",0.4);b&&b.sprite&&"springcow"==b.sprite.name&&!0!==b.data.shapes[0].sensor?(b.sprite==hitSprite&&(gummi.visible=!1),b.data.shapes[0].sensor=!0,game.sound.play("moo2",0.2),game.physics.p2.createRevoluteConstraint(b,[0,2],a,[0,0],1E4),game.add.tween(b.sprite).to({alpha:0},500,Phaser.Easing.Linear.None,!0,0,0,!1),game.add.tween(b.sprite.scale).to({x:0.5,y:0.5},1E3,Phaser.Easing.Linear.None,!0,0,0,!1),dropsemitter.x=a.x,dropsemitter.y=a.y,dropsemitter.explode(2E3,
20),gamestate="lost",hitSprite=b,b.sprite.health=0,game.time.events.add(2*Phaser.Timer.SECOND,function(){fadeOut("finish")})):b&&(b.sprite&&"tux"==b.sprite.type)&&(b.sprite==hitSprite&&(gummi.visible=!1),totalAssetsDestroyed+=1,b.setCollisionGroup(nocollideCG),game.physics.p2.createRevoluteConstraint(b,[0,2],a,[0,0],1E4),game.add.tween(b.sprite).to({alpha:0},500,Phaser.Easing.Linear.None,!0,0,0,!1),game.add.tween(b.sprite.scale).to({x:0.5,y:0.5},1E3,Phaser.Easing.Linear.None,!0,0,0,!1),"tuxice"==
b.sprite.name?(game.time.events.add(0.5*Phaser.Timer.SECOND,function(){a.setCollisionGroup(nocollideCG);a.sprite.freeze.animations.play("freeze")}),game.time.events.add(2*Phaser.Timer.SECOND,function(){a.sprite.freeze.destroy();a.sprite.destroy()})):(dropsemitter.x=a.x,dropsemitter.y=a.y,dropsemitter.explode(2E3,15)),"tuxanchor"==b.sprite.name&&(b.sprite.blockConstraint&&destroyAnchorConnection(b.sprite),game.add.tween(b.sprite.anchorgroup).to({alpha:0},500,Phaser.Easing.Linear.None,!0,0,0,!1).onComplete.add(function(){b.sprite.anchorgroup.destroy()})),
game.time.events.add(2*Phaser.Timer.SECOND,function(){hitSprite&&(hitSprite.body&&hitSprite.body.id===b.id)&&(hitSprite=!1);b.sprite&&b.sprite.destroy()}))}
function fetchBlock(a){if(!(this&&!0===this.onAir)&&(!a||!(a.sprite&&!0===a.sprite.chained))&&a&&a.sprite&&"iceblock"==a.sprite.name&&!this.tux.blockConstraint)a.sprite.event_becomeStatic&&game.time.events.remove(a.sprite.event_becomeStatic),a.sprite.body.dynamic=!0,a.sprite.body.mass=40,a.sprite.body.damping=0.4,a.sprite.body.angularDamping=0.4,this.body.onBeginContact.remove(fetchBlock,this),this.tux.blockConstraint=game.physics.p2.createRevoluteConstraint(a,[0,10],this,[0,-10],1E4),this.tux.blockConstraint.collideConnected=
!1,a.sprite.chained=!0,a.sprite.blockAnchor=this}
function onPresolve(a){for(var b=0;b<a.contactEquations.length;b++)if(c=a.contactEquations[b],f=a.frictionEquations[b],c.bodyB.parent&&c.bodyB.parent.sprite&&"rampfromleft"===c.bodyB.parent.sprite.name){var d=p2.vec2.fromValues(1,0),d=p2.vec2.dot(c.normalA,d);if(0>=d)if(c.enabled=!1,f&&(f.enabled=!1),!0===c.bodyA.parent.data.shapes[0].sensor)break;else c.bodyA.parent.data.shapes[0].sensor=!0,jumpOnRamp(c.bodyA.parent)}else if(c.bodyA.parent&&c.bodyA.parent.sprite&&"rampfromleft"===c.bodyA.parent.sprite.name){if(d=
p2.vec2.fromValues(1,0),d=p2.vec2.dot(c.normalA,d),0<=d)if(c.enabled=!1,f&&(f.enabled=!1),!0===c.bodyB.parent.data.shapes[0].sensor)break;else c.bodyB.parent.data.shapes[0].sensor=!0,jumpOnRamp(c.bodyB.parent)}else if(c.bodyB.parent&&c.bodyB.parent.sprite&&"rampfromright"===c.bodyB.parent.sprite.name){if(d=p2.vec2.fromValues(1,0),d=p2.vec2.dot(c.normalA,d),0<=d)if(c.enabled=!1,f&&(f.enabled=!1),!0===c.bodyA.parent.data.shapes[0].sensor)break;else c.bodyA.parent.data.shapes[0].sensor=!0,jumpOnRamp(c.bodyA.parent)}else if(c.bodyA.parent&&
(c.bodyA.parent.sprite&&"rampfromright"===c.bodyA.parent.sprite.name)&&(d=p2.vec2.fromValues(1,0),d=p2.vec2.dot(c.normalA,d),0>=d))if(c.enabled=!1,f&&(f.enabled=!1),!0===c.bodyB.parent.data.shapes[0].sensor)break;else c.bodyB.parent.data.shapes[0].sensor=!0,jumpOnRamp(c.bodyB.parent)}
function jumpOnRamp(a){if(a||a.sprite){a.sprite.onAir=!0;hitSprite&&(hitSprite.body&&hitSprite.body.id===a.id)&&(clearAllTies(),game.input.activePointer.isDown=!1);var b=Math.abs(a.velocity.x),d=a.sprite.scale.x;if(420<b)var e=600,b=400,l=1.4;else if(240<b)e=500,b=300,l=1.2;else{a.velocity.x=0>a.velocity.x?a.velocity.x-50:a.velocity.x+50;game.add.tween(a.velocity).to({x:-1*a.velocity.x},300,Phaser.Easing.Sinusoidal.InOut,!0,0,0,!1);game.time.events.add(1E3,function(){a&&a.sprite&&(a.data.shapes[0].sensor=
!1,a.sprite.onAir=!1)});return}e=game.add.tween(a.sprite.scale).to({x:l,y:l},e,Phaser.Easing.Sinusoidal.Out);d=game.add.tween(a.sprite.scale).to({x:d,y:d},b,Phaser.Easing.Sinusoidal.In);d.onComplete.add(function(){a&&a.sprite&&(a.sprite.onAir=!1,checkHitLandig(a))});e.chain(d).start()}}
function checkHitLandig(a){var b=game.physics.p2.hitTest({x:a.x,y:a.y});for(i=0;i<b.length;i++)if(b[i].parent&&b[i].parent.sprite&&"iceblock"==b[i].parent.sprite.name)var d=!0,e="block";else b[i].parent&&b[i].parent.sprite&&"woodblock"==b[i].parent.sprite.name?(d=!0,e="block"):b[i].parent&&b[i].parent.sprite&&"ramp"==b[i].parent.sprite.type?(d=!1,e="ramp"):b[i].parent&&!0===b[i].parent.ground?(d=!0,e="ground"):(d=!1,e="floor");a.sprite&&"springcow"==a.sprite.name&&(!0===d||!1===game.world.bounds.intersects(a)||
0>a.x)?(game.sound.play("mooa"+game.rnd.between(1,2)+"",0.2),gamestate="lost",a.sprite.health=0,a.sprite.healthbar.width=0,a.setZeroVelocity(),a.sprite.animations.play("die"),game.time.events.add(2*Phaser.Timer.SECOND,function(){fadeOut("finish")})):a.sprite&&"tux"==a.sprite.type&&!0===d?(totalAssetsDestroyed+=1,("tuxbomb"==a.sprite.name||"tuxminibomb"==a.sprite.name)&&"block"===e?a.data.shapes[0].sensor=!1:(a.setZeroVelocity(),thissprite=a.sprite,"tuxanchor"==thissprite.name&&(thissprite.blockConstraint&&
destroyAnchorConnection(thissprite),game.add.tween(thissprite.anchorgroup).to({alpha:0},1E3,Phaser.Easing.Quadratic.InOut,!0,0,0,!1).onComplete.add(function(){thissprite.anchorgroup.destroy()})),a.sprite.body=null,a.destroy(),game.add.tween(thissprite).to({alpha:0},1E3,Phaser.Easing.Quadratic.InOut,!0,0,0,!1),game.time.events.add(2E3,function(){hitSprite=!1;thissprite.destroy()},this))):a.sprite&&"chain"===a.sprite.type&&!0===d?game.time.events.add(2E3,function(){a.data.shapes[0]&&(a.data.shapes[0].sensor=
!1)},this):!1===game.world.bounds.intersects(a)||0>a.x?(a.sprite&&"tux"==a.sprite.type&&(totalAssetsDestroyed+=1),a.sprite&&a.sprite.destroy(),a=null,hitSprite=!1):"ramp"===e?game.time.events.add(1E3,function(){a.data.shapes[0]&&(a.data.shapes[0].sensor=!1)},this):a.data.shapes[0]&&(a.data.shapes[0].sensor=!1)}
function checkHit(a,b){var d=game.physics.p2.hitTest({x:mouseAnchor.x,y:mouseAnchor.y});for(i=0;i<d.length;i++){if(d[i].parent.sprite&&"springcow"==d[i].parent.sprite.name&&!d[i].parent.sprite.onAir){hitSprite=d[i].parent.sprite;lastHealthbar=currentHealthbar;currentHealthbar=hitSprite.healthbar;if(0==hitSprite.health&&"menu"!==level)break;totalHits+=1;hitSprite.health-=1;hitSprite.healthbar.width-=41;game.sound.play("moo"+game.rnd.between(1,6)+"",0.2);0==hitSprite.health&&"menu"!==level&&(hitSprite.filters=
[gray],hitSprite.alpha=0.8,game.add.tween(playerinfo).to({alpha:1},300,Phaser.Easing.Linear.None).to({alpha:0},1500,Phaser.Easing.Linear.None).start());return!0}if(d[i].parent.sprite&&"tux"==d[i].parent.sprite.type&&!d[i].parent.sprite.onAir){hitSprite=d[i].parent.sprite;lastHealthbar=currentHealthbar;currentHealthbar=hitSprite.healthbar;if(0==hitSprite.health&&"menu"!==level)break;game.sound.play("penguin"+game.rnd.between(1,3)+"",0.4);hitSprite.animations.play("walk");hitSprite.health-=1;hitSprite.healthbar.width-=
54;hitSprite.trigger&&(hitSprite.activetrigger=!0);0==hitSprite.health&&(hitSprite.filters=[gray],hitSprite.alpha=0.8,game.add.tween(playerinfo).to({alpha:1},300,Phaser.Easing.Linear.None).to({alpha:0},1500,Phaser.Easing.Linear.None).start());return!0}}return!1}
function showIngameMenu(){!0==menu.visible?menu.forEach(function(a){game.add.tween(a).to({x:"+100"},a.speed,Phaser.Easing.Quadratic.In,!0);game.time.events.add(300,function(){menu.visible=!1})}):(menu.visible=!0,menu.forEach(function(a){a.x=worldwidth+40;game.add.tween(a).to({x:"-100"},a.speed,Phaser.Easing.Quadratic.Out,!0)}))}
function clearAllTies(){constraintcount=0;mouseAnchor&&mouseAnchor.body&&(mouseAnchor.body.x=0,mouseAnchor.body.y=0);var a=game.physics.p2.getSprings();if(0<a.length)for(i=0;i<=a.length;i++)game.physics.p2.removeSpring(a[i])}function clearAllConstraints(){var a=game.physics.p2.getConstraints();if(0<a.length)for(i=0;i<=a.length;i++)game.physics.p2.removeConstraint(a[i])}
function destroyAnchorConnection(a){"tux"!==a.type&&(a=hitSprite);if(a.blockConstraint){var b=a.blockConstraint.bodyA.parent,d=a.blockConstraint.bodyB.parent;b.sprite.chained=!1;game.physics.p2.removeConstraint(a.blockConstraint);a.blockConstraint=null;game.time.events.add(1E3,function(){d.onBeginContact.add(fetchBlock,d.sprite)},this);b.sprite.event_becomeStatic=game.time.events.add(4*Phaser.Timer.SECOND,function(){"cowsonice-tileset-64-2.png"==b.sprite.frameName&&(b.static=!0);b.damping=0.992;b.angularDamping=
0.999},this)}else console.log("got this strange error in destroyAnchorConnection")}function accelerateToObject(a,b,d){a.body&&("undefined"===typeof d&&(d=60),b=Math.atan2(b.y-a.y,b.x-a.x),a.body.force.x=Math.cos(b)*d,a.body.force.y=Math.sin(b)*d)}function distanceBetween(a,b){var d=a.x-b.x,e=a.y-b.y;return Math.sqrt(d*d+e*e)}function angleBetween(a,b){return 180*Math.atan2(b.y-a.y,b.x-a.x)/Math.PI}
function constrainVelocity(a,b){if(a&&a.body){var d=a.body,e,l,g;l=d.data.velocity[0];g=d.data.velocity[1];e=l*l+g*g;1.4>=e&&(0==constraintcount&&!0!==a.finished&&"lost"!==gamestate&&0==a.health&&"menu"!=level)&&("springcow"==a.name?(gamestate="lost",hitSprite.animations.play("die"),game.time.events.add(2*Phaser.Timer.SECOND,function(){fadeOut("finish")})):(a.finished=!0,"tuxanchor"==a.name&&(a.blockConstraint&&destroyAnchorConnection(a),game.add.tween(a.anchorgroup).to({alpha:0},1E3,Phaser.Easing.Quadratic.InOut,
!0,0,0,!1).onComplete.add(function(){a.anchorgroup.destroy()})),tween1=game.add.tween(a).to({alpha:0},1E3,Phaser.Easing.Exponential.InOut,!0).onComplete.add(function(){a.destroy();hitSprite&&a==hitSprite&&(hitSprite=!1)})));e>b*b&&(e=Math.atan2(g,l),l=Math.cos(e)*b,g=Math.sin(e)*b,d.data.velocity[0]=l,d.data.velocity[1]=g)}}
function fadeOut(a){!0===ADS&&(game.time.events.remove(ADtimer),NoFAD=!0);texture=new PIXI.RenderTexture(game.width,game.height,game.renderer);matrix=new PIXI.Matrix;matrix.translate(-game.camera.x,-game.camera.y);texture.render(game.world,matrix);cover=new Phaser.Sprite(game,0,0,texture);cover.fixedToCamera=!0;cover.anchor.setTo(0.5,0.5);cover.cameraOffset.x=game.width/2;cover.cameraOffset.y=game.height/2;!0===ADS&&kill_bAD();game.state.start(""+a+"")}
function fadeIn(){cover&&(tween1=game.add.tween(cover).to({alpha:0},1E3,Phaser.Easing.Exponential.InOut,!0),tween2=game.add.tween(cover.scale).to({x:1.5,y:1.5},1E3,Phaser.Easing.Exponential.InOut,!0),tween2.onComplete.addOnce(destroyCover,this))}
function destroyCover(){cover&&cover.destroy();cover=null;texture&&texture.destroy();texture=null;0==level&&"finish"!=game.state.current&&!0==justLost?(justlost=!1,introTween()):0==level&&"finish"!=game.state.current&&!1==justLost?(skipintrobutton=game.add.button(40,40,"allsprites",function(){justLost=!0},this,"signs-forward.png","signs-forward.png","signs-forward.png"),skipintrobutton.anchor.setTo(0.5,0.5),skipintrobutton.fixedToCamera=!0,introtext="",introindex=0,introline="",introtext=game.add.bitmapText(32,
worldheight-60,"desyrel","",24),introtext.fixedToCamera=!0,(heartbeat=game.add.audio("heartbeat",1,!0))&&heartbeat.isPlaying&&heartbeat.stop(),heartbeat.play("",0,1,!0),nextLine(),mapSizeMaxCurrent=mapSizeMax):"menu"!=level&&"finish"!=level&&(tweenx1=game.add.tween(switchfocusbutton.scale).to({x:1.4,y:1.4},200,Phaser.Easing.Linear.None,!0,0,5,!0),tweenx2=game.add.tween(icon_zoom.scale).to({x:1.4,y:1.4},200,Phaser.Easing.Linear.None,!0,0,5,!0),tweenx3=game.add.tween(leveltext).to({alpha:0},2E3,Phaser.Easing.Linear.None,
!0))}function updateLine(){introline.length<content[introindex].length?(0==introline.length%2&&game.sound.play("click"+game.rnd.between(1,3)+"",0.2),introline=content[introindex].substr(0,introline.length+1),introtext.setText(introline)):game.time.events.add(2*Phaser.Timer.SECOND,nextLine,this)}
function nextLine(){introindex++;introindex<content.length&&!1==justLost?(introline="",game.time.events.repeat(60,content[introindex].length+1,updateLine,this)):(tweenx=game.add.tween(skipintrobutton).to({alpha:0},200,Phaser.Easing.Linear.None,!0),tweenx=game.add.tween(introtext).to({alpha:0},200,Phaser.Easing.Linear.None,!0),game.time.events.add(1E3,introTween))}
function introTween(){switchfocusbutton.visible=!0;icon_switchfocus.visible=!0;tweenx0=game.add.tween(stageGroup).to({alpha:1},600,Phaser.Easing.Linear.None,!0);tweenx1=game.add.tween(switchfocusbutton).to({alpha:1},600,Phaser.Easing.Linear.None,!0);tweenx2=game.add.tween(icon_switchfocus).to({alpha:1},600,Phaser.Easing.Linear.None,!0);music1.isPlaying||(heartbeat&&heartbeat.fadeOut(700),music1.play("",0,0.8,!0));!0==justLost?(hitSprite=actors[1],tweenx1=game.add.tween(switchfocusbutton.scale).to({x:1.4,
y:1.4},200,Phaser.Easing.Linear.None,!0,0,5,!0),tweenx2=game.add.tween(icon_switchfocus.scale).to({x:1.4,y:1.4},200,Phaser.Easing.Linear.None,!0,0,5,!0)):(tweenx=game.add.tween(game.camera).to({x:1530,y:480},3600,Phaser.Easing.Exponential.InOut).to({x:0,y:470},3E3,Phaser.Easing.Exponential.InOut).to({x:0,y:470},3E3,Phaser.Easing.Exponential.InOut).to({x:680,y:400},3E3,Phaser.Easing.Exponential.InOut).to({x:680,y:400},3E3,Phaser.Easing.Exponential.InOut).to({x:0,y:0},3E3,Phaser.Easing.Exponential.InOut).to({x:0,
y:0},3E3,Phaser.Easing.Exponential.InOut).to({x:1520,y:110},3E3,Phaser.Easing.Exponential.InOut).to({x:1520,y:110},3E3,Phaser.Easing.Exponential.InOut).to({x:1010,y:0},3E3,Phaser.Easing.Exponential.InOut).to({x:1010,y:0},3E3,Phaser.Easing.Linear.None),tweenx.onComplete.add(function(){hitSprite=actors[1];tweenx1=game.add.tween(switchfocusbutton.scale).to({x:1.4,y:1.4},200,Phaser.Easing.Linear.None,!0,0,5,!0);tweenx2=game.add.tween(icon_switchfocus.scale).to({x:1.4,y:1.4},200,Phaser.Easing.Linear.None,
!0,0,5,!0)}),tweenx.start())}
function switchfocus(){if(!0===zoomed)stageGroup.filters="",currentcameraposition=zoomed=!1,mapSizeMaxCurrent=mapSizeMax,"springcow"==hitSprite.name?game.sound.play("moo"+game.rnd.between(1,6)+"",0.2):"tux"==hitSprite.type&&game.sound.play("penguin"+game.rnd.between(1,3)+"",0.4);else if(hitSprite.blockConstraint)destroyAnchorConnection(hitSprite);else if(hitSprite.trigger&&hitSprite.activetrigger)helperTuxCollision(hitSprite);else if(0==level&&tweenx.isRunning)tweenx.stop(!0);else{for(i=0;i<totalActors;i++)if(actors[i]===
follow){var a=i+1;for(a>=totalActors&&(a=0);;)if(actors[a].alive){hitSprite=actors[a];lastHealthbar=currentHealthbar;currentHealthbar=hitSprite.healthbar;"springcow"==hitSprite.name?game.sound.play("moo"+game.rnd.between(1,6)+"",0.2):"tux"==hitSprite.type&&game.sound.play("penguin"+game.rnd.between(1,3)+"",0.4);break}else a++;return}hitSprite=!1}}
function updateSpringAssets(){if(!zoomed){if(!inputBlock&&game.input.activePointer.isDown&&0===constraintcount&&checkHit()&&(!game.input.pointer1.isDown||!game.input.pointer2.isDown))follow=!1,constraintcount+=1,hitSprite.spring=game.physics.p2.createSpring(hitSprite,mouseAnchor,0,30,2),gummi.visible=!0;if(!game.input.activePointer.isDown)if(gummi.visible=!1,0!==constraintcount&&clearAllTies(),hitSprite&&"tux"==hitSprite.type)hitSprite.animations.stop(),follow=hitSprite;else if(hitSprite)follow=hitSprite;
else for(i=0;i<cowsInLevel;i++)if(!0!==cows[i].finished){hitSprite=cows[i];lastHealthbar=currentHealthbar;currentHealthbar=hitSprite.healthbar;break}currentHealthbar&&(lastHealthbar.visible=!1,currentHealthbar.visible=!0);constrainVelocity(hitSprite,170)}}
function updateLevelstatus(){game.input.keyboard.isDown(Phaser.Keyboard.A)&&mapSizeMaxCurrent<mapSizeMax?(mapSizeMaxCurrent+=32,mapSizeMaxCurrent=Phaser.Math.clamp(mapSizeMaxCurrent,worldheight,mapSizeMax)):game.input.keyboard.isDown(Phaser.Keyboard.O)&&mapSizeMaxCurrent>worldheight&&(mapSizeMaxCurrent-=32,mapSizeMaxCurrent=Phaser.Math.clamp(mapSizeMaxCurrent,worldheight,mapSizeMax));game.input.pointer1.isDown&&game.input.pointer2.isDown&&(olddistance=distance,distance=Phaser.Math.distance(game.input.pointer1.x,
game.input.pointer1.y,game.input.pointer2.x,game.input.pointer2.y),distancedelta=Math.abs(olddistance-distance),olddistance>distance&&4<distancedelta&&mapSizeMaxCurrent>worldheight?mapSizeMaxCurrent-=32:olddistance<distance&&(4<distancedelta&&mapSizeMaxCurrent<mapSizeMax)&&(mapSizeMaxCurrent+=32),mapSizeMaxCurrent=Phaser.Math.clamp(mapSizeMaxCurrent,worldheight,mapSizeMax));worldScale=mapSizeMaxCurrent/mapSizeMax*initialWorldScale;mapSizeMaxCurrent<mapSizeMax?(zoomed=!0,stageGroup.scale.set(worldScale),
currentBounds=new Phaser.Rectangle(0,0,mapSizeX*worldScale,mapSizeY*worldScale),game.camera.bounds=currentBounds):stageGroup.scale.x!=initialWorldScale&&(stageGroup.scale.x>=0.999*initialWorldScale?(zoomed=!1,stageGroup.scale.x=initialWorldScale,stageGroup.scale.y=initialWorldScale,currentBounds=new Phaser.Rectangle(0,0,mapSizeX*stageGroup.scale.x,mapSizeY*stageGroup.scale.y),game.camera.bounds=currentBounds):stageGroup.scale.x!=1*initialWorldScale&&(currentcameraposition=zoomed=!1,stageGroup.scale.x+=
0.1*(1*initialWorldScale-stageGroup.scale.x),stageGroup.scale.y+=0.1*(1*initialWorldScale-stageGroup.scale.y),currentBounds=new Phaser.Rectangle(0,0,mapSizeX*stageGroup.scale.x,mapSizeY*stageGroup.scale.y),game.camera.bounds=currentBounds));if(!1===zoomed){if(follow){var a=Phaser.Math.distance(game.camera.view.centerX,game.camera.view.centerY,follow.x,follow.y);64<a&&(cameraPos.x=game.camera.view.centerX,cameraPos.y=game.camera.view.centerY);2<a&&(ease=0.1,cameraPos.x+=(follow.x*worldScale-cameraPos.x)*
ease,cameraPos.y+=(follow.y*worldScale-cameraPos.y)*ease,game.camera.focusOnXY(cameraPos.x,cameraPos.y))}!1===gamemenu.visible&&!hitSprite.blockConstraint&&!hitSprite.activetrigger?(gamemenu.visible=!0,stageGroup.filters="",game.add.tween(gamemenu).to({alpha:1},200,Phaser.Easing.Linear.None).start(),!0===anchormenu.visible&&(a=game.add.tween(anchormenu).to({alpha:0},200,Phaser.Easing.Linear.None),game.time.events.add(200,function(){anchormenu.visible=!1}),a.start()),game.time.events.add(200,function(){game.add.tween(switchfocusbutton).to({x:worldwidth-
60,y:worldheight-60},400,Phaser.Easing.Exponential.InOut,!0);game.add.tween(icon_zoom).to({x:worldwidth-60,y:worldheight-60},400,Phaser.Easing.Exponential.InOut,!0);game.add.tween(icon_anchor).to({x:worldwidth-60,y:worldheight-60},400,Phaser.Easing.Exponential.InOut,!0);game.add.tween(icon_switchfocus).to({x:worldwidth-60,y:worldheight-60},400,Phaser.Easing.Exponential.InOut,!0)})):(hitSprite.blockConstraint||hitSprite.trigger&&hitSprite.activetrigger)&&!1===anchormenu.visible?(anchormenu.visible=
!0,stageGroup.filters="",game.add.tween(anchormenu).to({alpha:1},200,Phaser.Easing.Linear.None).start(),!0===gamemenu.visible&&(a=game.add.tween(gamemenu).to({alpha:0},200,Phaser.Easing.Linear.None),game.time.events.add(200,function(){gamemenu.visible=!1}),a.start()),game.time.events.add(200,function(){game.add.tween(switchfocusbutton).to({x:worldwidth-60,y:worldheight-60},400,Phaser.Easing.Exponential.InOut,!0);game.add.tween(icon_zoom).to({x:worldwidth-60,y:worldheight-60},400,Phaser.Easing.Exponential.InOut,
!0);game.add.tween(icon_anchor).to({x:worldwidth-60,y:worldheight-60},400,Phaser.Easing.Exponential.InOut,!0);game.add.tween(icon_switchfocus).to({x:worldwidth-60,y:worldheight-60},400,Phaser.Easing.Exponential.InOut,!0)})):!0==zoommenu.visible&&(stageGroup.filters="",a=game.add.tween(zoommenu).to({alpha:0},200,Phaser.Easing.Linear.None),game.time.events.add(200,function(){zoommenu.visible=!1}),a.start())}else game.input.activePointer.isDown&&!game.input.pointer2.isDown?(oldcamera&&(game.camera.x+=
oldcamera.x-game.input.activePointer.position.x,game.camera.y+=oldcamera.y-game.input.activePointer.position.y),oldcamera=game.input.activePointer.position.clone(),rescalefactorx=mapSizeX/(mapSizeX*worldScale),rescalefactory=mapSizeY/(mapSizeY*worldScale),currentcamerapositionX=game.camera.view.centerX*rescalefactorx,currentcamerapositionY=game.camera.view.centerY*rescalefactory,currentcameraposition=!0):(oldcamera=null,!1===currentcameraposition&&(rescalefactorx=mapSizeX/(mapSizeX*worldScale),rescalefactory=
mapSizeY/(mapSizeY*worldScale),currentcamerapositionX=game.camera.view.centerX*rescalefactorx,currentcamerapositionY=game.camera.view.centerY*rescalefactory,currentcameraposition=!0),followx=currentcamerapositionX*worldScale,followy=currentcamerapositionY*worldScale,game.camera.focusOnXY(followx,followy)),!1===zoommenu.visible&&(zoommenu.visible=!0,stageGroup.filters=[stagegray],game.add.tween(zoommenu).to({alpha:1},200,Phaser.Easing.Linear.None).start(),!0===gamemenu.visible&&(a=game.add.tween(gamemenu).to({alpha:0},
200,Phaser.Easing.Linear.None),game.time.events.add(200,function(){gamemenu.visible=!1}),a.start()),!0===anchormenu.visible&&(a=game.add.tween(anchormenu).to({alpha:0},200,Phaser.Easing.Linear.None),game.time.events.add(200,function(){anchormenu.visible=!1}),a.start()),game.time.events.add(200,function(){game.add.tween(switchfocusbutton).to({x:game.camera.width/2,y:worldheight-120},400,Phaser.Easing.Exponential.InOut,!0);game.add.tween(icon_zoom).to({x:game.camera.width/2,y:worldheight-120},400,Phaser.Easing.Exponential.InOut,
!0);icon_anchor.x=game.camera.width/2;icon_anchor.y=worldheight-120;icon_switchfocus.x=game.camera.width/2;icon_switchfocus.y=worldheight-120}))}if(navigator.isCocoonJS){window.cordova=null;var game=new Phaser.Game(worldwidth,worldheight,Phaser.CANVAS,"",{})}else game=new Phaser.Game(worldwidth,worldheight,Phaser.CANVAS,"",{});game.state.add("boot",BootState,!0);game.state.add("preload",PreloadState,!1);game.state.add("menu",Menu,!1);game.state.add("finish",Finish,!1);
game.state.add("final",Final,!1);for(i=0;i<levels;i++)game.state.add(""+i+"",states[i],!1);
